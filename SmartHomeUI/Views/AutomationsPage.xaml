<UserControl x:Class="SmartHomeUI.Views.AutomationsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="900" d:DesignWidth="1400">
    <UserControl.Resources>
        <!-- Scrollbar style for automation list -->
        <Style x:Key="AutomationScrollBarStyle" TargetType="ScrollBar">
            <Setter Property="Width" Value="6"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollBar">
                        <Grid Background="Transparent">
                            <Track x:Name="PART_Track" IsDirectionReversed="True">
                                <Track.DecreaseRepeatButton>
                                    <RepeatButton Command="ScrollBar.LineUpCommand" Opacity="0"/>
                                </Track.DecreaseRepeatButton>
                                <Track.IncreaseRepeatButton>
                                    <RepeatButton Command="ScrollBar.LineDownCommand" Opacity="0"/>
                                </Track.IncreaseRepeatButton>
                                <Track.Thumb>
                                    <Thumb Background="{StaticResource NeonCyan}" Width="6">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="Thumb">
                                                <Border Background="{TemplateBinding Background}" CornerRadius="3"/>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Neon scrollbar style for ComboBox dropdown -->
        <Style x:Key="NeonComboBoxScrollBar" TargetType="ScrollBar">
            <Setter Property="Width" Value="12"/>
            <Setter Property="Background" Value="#30161616"/>
            <Setter Property="Margin" Value="2,0,2,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollBar">
                        <Grid Background="{TemplateBinding Background}">
                            <Track x:Name="PART_Track" IsDirectionReversed="True">
                                <Track.DecreaseRepeatButton>
                                    <RepeatButton Command="ScrollBar.LineUpCommand" Opacity="0"/>
                                </Track.DecreaseRepeatButton>
                                <Track.IncreaseRepeatButton>
                                    <RepeatButton Command="ScrollBar.LineDownCommand" Opacity="0"/>
                                </Track.IncreaseRepeatButton>
                                <Track.Thumb>
                                    <Thumb Background="{StaticResource NeonCyan}" Width="10" Margin="1">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="Thumb">
                                                <Border Background="{TemplateBinding Background}" CornerRadius="5">
                                                    <Border.Effect>
                                                        <DropShadowEffect Color="#12E6D9" BlurRadius="8" ShadowDepth="0" Opacity="1"/>
                                                    </Border.Effect>
                                                </Border>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ScrollViewer style for ComboBox dropdown -->
        <Style x:Key="ComboBoxScrollViewerStyle" TargetType="ScrollViewer">
            <Setter Property="VerticalScrollBarVisibility" Value="Visible"/>
            <Setter Property="HorizontalScrollBarVisibility" Value="Disabled"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollViewer">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <ScrollContentPresenter Grid.Column="0"/>
                            <ScrollBar Grid.Column="1"
                                      x:Name="PART_VerticalScrollBar"
                                      Style="{StaticResource NeonComboBoxScrollBar}"
                                      Value="{TemplateBinding VerticalOffset}"
                                      Maximum="{TemplateBinding ScrollableHeight}"
                                      ViewportSize="{TemplateBinding ViewportHeight}"
                                      Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Border Style="{StaticResource GlassPanel}" Margin="10" Padding="20">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <TextBlock Text="Automations" Style="{StaticResource NeonTitleStyle}"/>

            <!-- Input form -->
            <Grid Grid.Row="1" Margin="0,14,0,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="180"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="220"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="90"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="120"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="90"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="Name" Style="{StaticResource InputLabelText}"/>
                    <TextBox x:Name="NameBox" Style="{StaticResource GlassTextBox}"/>
                </StackPanel>

                <StackPanel Grid.Column="2">
                    <TextBlock Text="Device" Style="{StaticResource InputLabelText}"/>
                    <ComboBox x:Name="DevicesBox"
                              SelectedValuePath="Id"
                              TextSearch.TextPath="Name"
                              MaxDropDownHeight="200">
                        <ComboBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <VirtualizingStackPanel/>
                            </ItemsPanelTemplate>
                        </ComboBox.ItemsPanel>
                        <ComboBox.Resources>
                            <Style TargetType="ScrollViewer" BasedOn="{StaticResource ComboBoxScrollViewerStyle}"/>
                        </ComboBox.Resources>
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Name}"
                                           TextTrimming="CharacterEllipsis">
                                    <TextBlock.ToolTip>
                                        <ToolTip Placement="Mouse"
                                                 HasDropShadow="False"
                                                 Background="Transparent"
                                                 BorderThickness="0">
                                            <Border Background="#161616"
                                                    BorderBrush="{StaticResource NeonCyan}"
                                                    BorderThickness="1"
                                                    CornerRadius="8"
                                                    Padding="10">
                                                <StackPanel>
                                                    <TextBlock Text="Device room"
                                                               Foreground="{StaticResource NeonCyan}"
                                                               FontWeight="Bold"/>
                                                    <TextBlock Margin="0,6,0,0"
                                                               Foreground="{StaticResource TextWhite}">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Setter Property="Text">
                                                                    <Setter.Value>
                                                                        <Binding Path="Room" StringFormat="Room: {0}"/>
                                                                    </Setter.Value>
                                                                </Setter>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Room}" Value="">
                                                                        <Setter Property="Text" Value="Room: not set"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding Room}" Value="{x:Null}">
                                                                        <Setter Property="Text" Value="Room: not set"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </StackPanel>
                                            </Border>
                                        </ToolTip>
                                    </TextBlock.ToolTip>
                                </TextBlock>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                </StackPanel>

                <StackPanel Grid.Column="4">
                    <TextBlock Text="Time" Style="{StaticResource InputLabelText}"/>
                    <TextBox x:Name="TimeBox" Style="{StaticResource GlassTextBox}" ToolTip="HH:mm"/>
                </StackPanel>

                <StackPanel Grid.Column="6">
                    <TextBlock Text="Action" Style="{StaticResource InputLabelText}"/>
                    <ComboBox x:Name="ActionBox">
                        <ComboBoxItem Content="Toggle" IsSelected="True"/>
                        <ComboBoxItem Content="SetValue"/>
                    </ComboBox>
                </StackPanel>

                <StackPanel Grid.Column="8">
                    <TextBlock Text="Value" Style="{StaticResource InputLabelText}"/>
                    <TextBox x:Name="ValueBox" Style="{StaticResource GlassTextBox}"/>
                </StackPanel>

                <StackPanel Grid.Column="10"
                            Orientation="Horizontal"
                            VerticalAlignment="Bottom">
                    <Button x:Name="AddOrUpdateButton"
                            Content="Add"
                            Width="110"
                            Style="{StaticResource GlassActionButton}"
                            Click="AddOrUpdate_Click"/>
                    <Button x:Name="CancelEditButton"
                            Content="Cancel"
                            Width="100"
                            Margin="8,0,0,0"
                            Style="{StaticResource GlassActionButton}"
                            Visibility="Collapsed"
                            Click="CancelEdit_Click"/>
                </StackPanel>
            </Grid>

            <!-- Bottom-left automation list -->
            <Grid Grid.Row="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="0.4*"/>
                    <RowDefinition Height="0.6*"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="1"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        Margin="0,24,0,16"
                        Padding="22"
                        BorderThickness="2"
                        CornerRadius="10"
                        BorderBrush="#12E6D9"
                        Background="#19061A1A">
                    <Border.Effect>
                        <DropShadowEffect Color="#12E6D9"
                                          BlurRadius="10"
                                          ShadowDepth="0"
                                          Opacity="0.7"/>
                    </Border.Effect>

                    <DockPanel LastChildFill="True">
                        <Grid DockPanel.Dock="Top" Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Automations"
                                       FontSize="20"
                                       FontWeight="Bold"
                                       Foreground="#12E6D9"
                                       VerticalAlignment="Center"/>
                            <Grid Grid.Column="1"
                                  HorizontalAlignment="Right">
                                <Border CornerRadius="8"
                                        BorderThickness="2"
                                        BorderBrush="#12E6D9"
                                        Background="#0A1414">
                                    <Grid>
                                        <TextBox x:Name="SearchBox"
                                                 Style="{StaticResource GlassTextBox}"
                                                 BorderThickness="0"
                                                 Background="Transparent"
                                                 Width="840"
                                                 Padding="12,6,48,6"
                                                 ToolTip="Search automations"
                                                 TextChanged="SearchBox_TextChanged"/>
                                        <Path Data="M9.5,8.5 C10.8807,8.5 12,7.38071 12,6 C12,4.61929 10.8807,3.5 9.5,3.5 C8.11929,3.5 7,4.61929 7,6 C7,7.38071 8.11929,8.5 9.5,8.5 Z M13,6 C13,7.933 11.433,9.5 9.5,9.5 C7.567,9.5 6,7.933 6,6 C6,4.067 7.567,2.5 9.5,2.5 C11.433,2.5 13,4.067 13,6 Z M12.6464,9.35355 L15.6464,12.3536 L14.9393,13.0607 L11.9393,10.0607 L12.6464,9.35355 Z"
                                              Stroke="#12E6D9"
                                              StrokeThickness="1.5"
                                              HorizontalAlignment="Right"
                                              VerticalAlignment="Center"
                                              Margin="0,0,12,0"
                                              Width="18"
                                              Height="18"
                                              Stretch="Uniform"
                                              IsHitTestVisible="False"/>
                                    </Grid>
                                </Border>
                            </Grid>
                        </Grid>
                        <Rectangle DockPanel.Dock="Top"
                                   Height="1"
                                   Margin="0,0,0,8"
                                   Fill="#3312E6D9"/>

                        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                            <ScrollViewer.Resources>
                                <Style TargetType="ScrollBar" BasedOn="{StaticResource AutomationScrollBarStyle}"/>
                            </ScrollViewer.Resources>
                            <ListView x:Name="List"
                                      Background="Transparent"
                                      BorderThickness="0"
                                      HorizontalContentAlignment="Stretch"
                                      ScrollViewer.VerticalScrollBarVisibility="Disabled"
                                      ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                                <ListView.Resources>
                                    <Style TargetType="ListViewItem">
                                        <Setter Property="Padding" Value="0"/>
                                        <Setter Property="Margin" Value="0,6,0,6"/>
                                        <Setter Property="Background" Value="Transparent"/>
                                        <Setter Property="BorderThickness" Value="0"/>
                                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                        <Setter Property="VerticalContentAlignment" Value="Stretch"/>
                                        <Setter Property="Focusable" Value="False"/>
                                    </Style>
                                </ListView.Resources>

                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Border Padding="10"
                                                Margin="4"
                                                CornerRadius="8"
                                                BorderThickness="1"
                                                BorderBrush="#12E6D9"
                                                Background="#19061A1A">
                                            <Border.Effect>
                                                <DropShadowEffect Color="#12E6D9"
                                                                  BlurRadius="8"
                                                                  ShadowDepth="0"
                                                                  Opacity="0.65"/>
                                            </Border.Effect>
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="BorderBrush" Value="#12E6D9"/>
                                                    <Setter Property="Effect">
                                                        <Setter.Value>
                                                            <DropShadowEffect Color="#12E6D9"
                                                                              BlurRadius="8"
                                                                              ShadowDepth="0"
                                                                              Opacity="0.65"/>
                                                        </Setter.Value>
                                                    </Setter>
                                                    <Style.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="BorderBrush" Value="#5CFFF7"/>
                                                            <Setter Property="Effect">
                                                                <Setter.Value>
                                                                    <DropShadowEffect Color="#12E6D9"
                                                                                      BlurRadius="12"
                                                                                      ShadowDepth="0"
                                                                                      Opacity="0.9"/>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>

                                            <Grid>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                </Grid.RowDefinitions>

                                                <TextBlock Grid.Row="0"
                                                           Text="{Binding Name}"
                                                           Foreground="{StaticResource NeonComboTextBrush}"
                                                           FontFamily="Segoe UI Semibold"
                                                           FontSize="16"
                                                           Margin="0,0,0,6"/>

                                                <Grid Grid.Row="1">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Text="{Binding TimeHHMm, StringFormat=At {0}}"
                                                               Foreground="{StaticResource NeonComboTextBrush}"
                                                               FontFamily="Segoe UI Semibold"
                                                               FontSize="14"/>
                                                    <CheckBox Grid.Column="1"
                                                              Content="Enabled"
                                                              Margin="12,0,0,0"
                                                              VerticalAlignment="Center"
                                                              Foreground="{StaticResource NeonComboTextBrush}"
                                                              IsChecked="{Binding Enabled}"
                                                              Tag="{Binding}"
                                                              Click="Enabled_Click"/>
                                                </Grid>

                                                <TextBlock Grid.Row="2"
                                                           Margin="0,8,0,0"
                                                           Foreground="{StaticResource NeonComboTextBrush}"
                                                           FontFamily="Segoe UI Semibold"
                                                           FontSize="14">
                                                    <Run Text="{Binding Action}"/>
                                                    <Run Text=" â†’ "/>
                                                    <Run Text="{Binding DeviceName}"/>
                                                    <Run Text=" "/>
                                                    <Run Text="{Binding Value}"/>
                                                </TextBlock>

                                                <StackPanel Grid.Row="3"
                                                            Margin="0,12,0,0"
                                                            Orientation="Horizontal"
                                                            HorizontalAlignment="Right">
                                                    <Button Content="Edit"
                                                            Width="90"
                                                            Style="{StaticResource GlassActionButton}"
                                                            Margin="0,0,10,0"
                                                            Tag="{Binding}"
                                                            Click="Edit_Click"/>
                                                    <Button Content="Run now"
                                                            Width="100"
                                                            Style="{StaticResource GlassActionButton}"
                                                            Margin="0,0,10,0"
                                                            Tag="{Binding}"
                                                            Click="RunNow_Click"/>
                                                    <Button Content="Delete"
                                                            Width="90"
                                                            Style="{StaticResource GlassActionButton}"
                                                            Tag="{Binding}"
                                                            Click="Delete_Click"/>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ListView.ItemTemplate>

                                <ListView.Style>
                                    <Style TargetType="ListView">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ListView">
                                                    <Grid>
                                                        <ItemsPresenter/>
                                                        <TextBlock Text="No automations yet. Create one above."
                                                                   Foreground="{StaticResource TextDimmed}"
                                                                   HorizontalAlignment="Center"
                                                                   VerticalAlignment="Center"
                                                                   Visibility="Hidden"
                                                                   x:Name="EmptyHint"/>
                                                    </Grid>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="HasItems" Value="False">
                                                            <Setter TargetName="EmptyHint" Property="Visibility" Value="Visible"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </ListView.Style>
                            </ListView>
                        </ScrollViewer>
                    </DockPanel>
                </Border>
            </Grid>
        </Grid>
    </Border>
</UserControl>

